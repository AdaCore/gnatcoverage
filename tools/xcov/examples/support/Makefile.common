# This file contains the common definitions used by all other Makefiles.

QEMU=qemu-system-ppc
XCOV=xcov

# Set of main target programs for which we want to produce coverage info,
# to be defined from the command line or by includers:
# TESTS=

# Both a target specific support subdir and a target toolchain prefix:
TARGET = powerpc-elf

# Base dir for the support library:
BASE_SUPPORT_DIR = ../support

# CROSS toolchain : produce executable program from sources + target bsp

ifneq ($(TARGET),)
  CROSSPREFIX = $(TARGET)-
  TARGETNAME = $(TARGET)
else
  CROSSPREFIX =
  TARGETNAME = native
endif

# Determine tty adjustments commands around xcov --run,
# default to NOPs.
STTY_ADJUST=
STTY_RESTORE=

ifneq ($(TERM),)
# - in case of regular tests, forces "stty raw"
# - in case of unit tests, do not do this (wrong output with AUnit)
ifeq ($(UNIT_TESTS),)
  STTY_ADJUST = stty raw
  STTY_RESTORE = stty $(shell stty -g)
endif
endif

# Access to common support files like this Makefile and to target specific
# sources such as the qemu bsp:
TARGET_SUPPORT_LIB = $(BASE_SUPPORT_DIR)/lib/$(TARGETNAME)
TARGETCONFIG=$(TARGET_SUPPORT_LIB)/$(TARGETNAME).cgpr

BUILDER=gprbuild -XTARGET=$(TARGETNAME) --config=$(TARGETCONFIG)
MKDIR=mkdir -p
RM=rm
CP=cp

