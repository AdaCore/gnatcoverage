<project name="GNATCoverage" scripts="qm_plugins">

  <repository name="plans" class="fs" root="./plans"/>
  <repository name="tor" class="fs" root="../../testsuite/Qualif"/>
  <repository name="report" class="fs" root="../../testsuite/qreport"/>

<!-- PLANS -->

  <artifact_class name="Environment" role="artifact">
    <location_content mime="text/x-python"/>
  </artifact_class>

 <artifact_class name="Root_Document" role="document">
    <location_container>
      <resource name="content" location="content.rst" mime="text/x-rst"/>
      <resource name="config" location="conf.py" mime="text/x-python"/>
    </location_container>
  </artifact_class>

  <artifact_class name="Chapter" role="document">
    <location_container>
      <resource name="content" location="content.rst" mime="text/x-rst"/>
    </location_container>
  </artifact_class>

  <artifact_class name="PDF" role="pdf">
    <location_content mime="application/pdf"/>
  </artifact_class>

  <link_definition kind="dependency" name="ENV_PDF">
    <from class="Environment"/>
    <to class="PDF"/>
  </link_definition>

  <link_definition kind="dependency" name="DOC_PDF">
    <from class="Root_Document"/>
    <to class="PDF"/>
  </link_definition>

  <artifact_factory class="Environment">
    <on_location pattern="env.py" type="content"/>
    <creates name="environment"/>
  </artifact_factory>

  <artifact_factory class="Root_Document">
    <on_location pattern="plans:///conf.py"
                 type="content"/>
    <creates location="$location.container" name="plans"/>
  </artifact_factory>

  <artifact_factory class="PDF">
    <on_location relative_class="Root_Document"
                 pattern="/build/latexpdf/$relative.name.pdf"
                 type="content"/>
    <creates name="$location.basename">
      <link_constructor implements="ENV_PDF">
        <from instance="environment"/>
      </link_constructor>
      <link_constructor implements="DOC_PDF">
        <from instance="$relative"/>
      </link_constructor>
    </creates>
  </artifact_factory>

  <artifact_factory name="Plan_Chapters" class="Chapter">
    <on_location relative_factory="Plan_Chapters"
                 pattern="$relative.location/*/content.rst"
                 type="content"/>
    <on_location relative_instance="/plans"
                 pattern="$relative.location/*/content.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename"/>
  </artifact_factory>

<!-- TOR -->

  <artifact_factory class="Root_Document">
    <on_location pattern="tor:///conf.py"
                 type="content"/>
    <creates location="$location.container" name="TOR_Doc"/>
  </artifact_factory>

  <artifact_factory name="Intro" class="Chapter">
    <on_location relative_instance="/TOR_Doc"
                 pattern="$relative.location/OpEnviron/content.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename"/>
  </artifact_factory>

  <artifact_class name="Appendix" inherits="Chapter">
    <location_container>
      <resource name="app" location="app.rst" mime="text/x-rst"/>
    </location_container>
  </artifact_class>

  <artifact_factory class="Appendix">
    <on_location relative_class="Appendix"
                 pattern="$relative.location/*/app.rst"
                 type="content"/>
    <on_location relative_instance="/TOR_Doc"
                 pattern="$relative.location/Appendix/content.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename"/>
  </artifact_factory>

  <artifact_class name="Req_Set" role="set">
    <location_container>
       <resource name="set_content" location="req_set.rst" mime="text/x-rst"/>
    </location_container>
  </artifact_class>

  <artifact_class name="Req" role="tor">
    <location_container>
       <resource name="requirement" location="req.rst" mime="text/x-rst"/>
    </location_container>
  </artifact_class>

  <artifact_class name="TC_Set" role="settest">
    <location_container>
       <resource name="tc_set_content" location="tc_set.rst" mime="text/x-rst"/>
    </location_container>
  </artifact_class>

  <artifact_class name="TC" role="testcase">
    <location_container>
       <resource name="tc_content" location="tc.rst" mime="text/x-rst"/>
       <resource name="ada_sources" location="src/*ad[bs]" mime="text/x-ada"/>
       <resource name="c_sources" location="src/*.c" mime="text/x-c"/>
       <resource name="h_sources" location="src/*.h" mime="text/x-h"/>
    </location_container>
  </artifact_class>

  <artifact_class name="TR" role="result">
    <location_container>
       <resource name="tr_content" location="test.py.out" mime="text/plain"/>
       <resource name="tr_err" location="test.py.err" mime="text/plain"/>
       <resource name="generated_rest" location="[^tc]*.rst" mime="text/x-rst"/>
    </location_container>
  </artifact_class>

  <link_definition kind="dependency" name="TOR_TC">
     <from class="Req"/>
     <to class="TC"/>
  </link_definition>

  <link_definition kind="dependency" name="TC_TR">
    <from class="TC"/>
    <to class="TR"/>
  </link_definition>

  <artifact_factory class="Req_Set">
    <on_location relative_instance="/TOR_Doc"
                 pattern="$relative.location/*/req_set.rst"
                 type="content"/>
    <on_location relative_class="Req_Set"
                 pattern="$relative.location/*/req_set.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename"/>
  </artifact_factory>

  <artifact_factory class="Req">
    <on_location relative_instance="/TOR_Doc"
                 pattern="$relative.location/*/req.rst"
                 type="content"/>
    <on_location relative_class="Req_Set"
                 pattern="$relative.location/*/req.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename"/>
  </artifact_factory>

  <artifact_factory class="TC_Set">
    <on_location relative_class="Req"
                 pattern="$relative.location/*/tc_set.rst"
                 type="content"/>
    <on_location relative_class="Req_Set"
                 pattern="$relative.location/*/tc_set.rst"
                 type="content"/>
    <on_location relative_class="TC_Set"
                 pattern="$relative.location/*/tc_set.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename"/>
  </artifact_factory>


  <artifact_factory class="TC">
    <on_location relative_class="Req"
                 pattern="$relative.location/*/tc.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename">
       <link_constructor implements="TOR_TC">
          <from instance="$relative"/>
       </link_constructor>
    </creates>
  </artifact_factory>

  <artifact_factory class="TC">
    <on_location relative_class="Req_Set"
                 pattern="$relative.location/*/tc.rst"
                 type="content"/>
    <on_location relative_class="TC_Set"
                 pattern="$relative.location/*/tc.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename">
      <link_constructor implements="TOR_TC">
          <from instance="$relative.relative"/>
      </link_constructor>
    </creates>
  </artifact_factory>


  <artifact_factory class="TC">
    <on_location relative_class="Req"
                 pattern="$relative.location/*/tc.rst"
                 type="content"/>
    <creates location="$location.container" name="$location.basename">
      <link_constructor implements="TOR_TC">
          <from instance="$relative"/>
      </link_constructor>
    </creates>
  </artifact_factory>


  <artifact_factory class="TR">
    <on_location relative_class="TC"
                 pattern="$relative.location/test.py.out"
                 type="content"/>
    <creates location="$location.container" name="$location.basename">
      <link_constructor implements="TC_TR">
        <from instance="$relative"/>
      </link_constructor>
   </creates>
  </artifact_factory>

  <artifact_factory class="TR">
    <on_location pattern="report:///source/"
                 type="container"/>
    <creates name="qreport"/>
  </artifact_factory>

</project>
